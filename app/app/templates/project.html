{% extends 'base.html' %}

{% block content %}

<h1><strong>Project:</strong> {{ project['name'] }}</h1>

<!-- Tabs -->
<section class="two-column-section">
    <div class="column-wide section">
        <section class="section discussion-section">

            <!-- Tabbed section -->
            <section class="section tabbed-section">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="details">
                        <h4>Project Details</h4>
                    </button>
                    <button class="tab-btn" data-tab="cycles">
                        <h4>Cycles</h4>
                    </button>
                    <button class="tab-btn" data-tab="history">
                        <h4>History</h4>
                    </button>
                </div>

                <!-- ---------------------- -->
                <!-- Active Tab -->
                <!-- ---------------------- -->
                <div class="tab-content active" id="details-tab">

                    <div class="section-header" style="padding:0px 0px 20px;">
                        <div>
                            <div class="timeline-title">üë®‚Äçüíª <strong>Owner:</strong> {{ project.dri }}<br>
                                ü§ù <strong>Team:</strong> {{ project.team }} <br>
                                üìÜ <strong>Started:</strong> {{ project.created.strftime('%b %d, %Y') }}
                            </div>

                        </div>
                        <div class="header-actions">
                            <a href="{{ url_for('edit_project', project_id=project.id) }}" class="btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                Edit Project
                            </a>
                            <form action="{{ url_for('delete_project', project_id=project.id) }}" method="POST" class="inline-form">
                                <button type="submit" class="btn-danger" onclick="return confirm('Are you sure you want to delete this project? This action cannot be undone.')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    Delete Project
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="project-item">
                        <div class="project-header">
                            <h5>Context and Background</h5>
                        </div>
                        <div class="project-meta">
                            {{ project.context }}
                        </div>
                    </div>

                    <div class="project-item">
                        <div class="project-header">
                            <h5>Reason for Prioritization</h5>
                        </div>
                        <div class="project-meta">
                            {{ project.why }}
                        </div>
                    </div>

                    <div class="project-item">
                        <div class="project-header">
                            <h5>Requirements</h5>
                        </div>
                        <div class="project-meta">
                            {{ project.requirements }}
                        </div>
                    </div>

                    <div class="project-item">
                        <div class="project-header">
                            <h5>Launch Plan</h5>
                        </div>
                        <div class="project-meta">
                            {{ project.launch }}
                        </div>
                    </div>

                </div>

                <!-- ---------------------- -->
                <!-- Cycles Tab -->
                <!-- ---------------------- -->
                <div class="tab-content" id="cycles-tab">
                    CYCLES PLACEHOLDER
                </div>

                <!-- ---------------------- -->
                <!-- History Tab -->
                <!-- ---------------------- -->
                <div class="tab-content" id="history-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h4>Changelog</h4>
                        </div>
                        <div class="card-body">
                            {% if changelogs %}
                            <ul class="list-group">
                                {% for log in changelogs %}
                                <li class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span>
                                            <strong>{{ log.change_type | title }}</strong>: {{ log.content }}
                                        </span>
                                        <small class="text-muted">
                                            {{ log.timestamp.strftime('%Y-%m-%d %H:%M') }} by {{ log.user.username }}
                                        </small>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="text-muted">No changes recorded yet.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </section>
        </section>
    </div>

    <div class="column-narrow section">
        <div class="section-header">
            <h3>Discussion</h3>
        </div>
        <div class="discussion-container">
            <!-- Comment Form -->
            <div class="comment-form-container">
                <form method="POST" action="{{ url_for('add_comment', project_id=project.id) }}">
                    {{ form.csrf_token }}
                    <div class="form-group">
                        {{ form.content.label }}
                        {{ form.content(class="form-control", rows=3) }}
          {% if form.content.errors %}
                        <div class="form-errors">
                            {% for error in form.content.errors %}
                            <span class="error">{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Submit</button>
                    </div>
                </form>
            </div>
            <!-- Comments List -->
            <div class="comments-list">
                {% for comment in comments %}
                <div class="comment-item">
                    <div class="comment-header">
                        {# <div class="user-avatar">{{ comment.user.username|truncate(1,true,'') }}</div> #}
                        <div class="comment-meta">
                            <span class="comment-author">{{ comment.user.username }}</span>
                            <span class="comment-date">{{ comment.created_at.strftime('%b %d, %Y at %H:%M') }}</span>
                        </div>
                        {% if current_user.id == comment.user_id %}
                        <div class="comment-actions">
                            <a href="{{ url_for('edit_comment', comment_id=comment.id) }}" class="btn-text">Edit</a>
                            <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="POST" class="inline-form">
                                <button type="submit" class="btn-text" onclick="return confirm('Are you sure you want to delete this comment?')">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                    <div class="comment-content">
                        {{ comment.content }}
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No comments yet. Be the first to add a comment!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<script>
    // Tabs functionality
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
    });
</script>
{% endblock %}